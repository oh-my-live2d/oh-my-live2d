(function(r,o){typeof exports=="object"&&typeof module!="undefined"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(r=typeof globalThis!="undefined"?globalThis:r||self,o(r.OML2D={}))})(this,function(r){"use strict";var st=Object.defineProperty;var _=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var N=(r,o,a)=>o in r?st(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a,R=(r,o)=>{for(var a in o||(o={}))nt.call(o,a)&&N(r,a,o[a]);if(_)for(var a of _(o))ot.call(o,a)&&N(r,a,o[a]);return r};var n=(r,o,a)=>(N(r,typeof o!="symbol"?o+"":o,a),a);var p=(r,o,a)=>new Promise((P,L)=>{var E=y=>{try{x(a.next(y))}catch(S){L(S)}},u=y=>{try{x(a.throw(y))}catch(S){L(S)}},x=y=>y.done?P(y.value):Promise.resolve(y.value).then(E,u);x((a=a.apply(r,o)).next())});window._iconfont_svg_string_3847283='<svg id="oml2d-icon-svg"><symbol id="icon-bed" viewBox="0 0 1280 1024"><path d="M352 512c88.22 0 160-71.78 160-160s-71.78-160-160-160-160 71.78-160 160 71.78 160 160 160z m704-256H608c-17.68 0-32 14.32-32 32v288H128V160c0-17.68-14.32-32-32-32H32C14.32 128 0 142.32 0 160v704c0 17.68 14.32 32 32 32h64c17.68 0 32-14.32 32-32v-96h1024v96c0 17.68 14.32 32 32 32h64c17.68 0 32-14.32 32-32V480c0-123.72-100.28-224-224-224z"  ></path></symbol><symbol id="icon-info-circle-fill" viewBox="0 0 1024 1024"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272z m-32-344c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"  ></path></symbol><symbol id="icon-heart-fill" viewBox="0 0 1024 1024"><path d="M923 283.6c-13.4-31.1-32.6-58.9-56.9-82.8-24.3-23.8-52.5-42.4-84-55.5-32.5-13.5-66.9-20.3-102.4-20.3-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5-24.4 23.9-43.5 51.7-56.9 82.8-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3 0.1-35.3-7-69.6-20.9-101.9z"  ></path></symbol><symbol id="icon-skin-fill" viewBox="0 0 1024 1024"><path d="M870 126H663.8c-17.4 0-32.9 11.9-37 29.3C614.3 208.1 567 246 512 246s-102.3-37.9-114.8-90.7c-4.1-17.4-19.5-29.3-37-29.3H154c-24.3 0-44 19.7-44 44v252c0 24.3 19.7 44 44 44h75v388c0 24.3 19.7 44 44 44h478c24.3 0 44-19.7 44-44V466h75c24.3 0 44-19.7 44-44V170c0-24.3-19.7-44-44-44z"  ></path></symbol><symbol id="icon-setting-fill" viewBox="0 0 1024 1024"><path d="M512.5 390.6c-29.9 0-57.9 11.6-79.1 32.8-21.1 21.2-32.8 49.2-32.8 79.1 0 29.9 11.7 57.9 32.8 79.1 21.2 21.1 49.2 32.8 79.1 32.8 29.9 0 57.9-11.7 79.1-32.8 21.1-21.2 32.8-49.2 32.8-79.1 0-29.9-11.7-57.9-32.8-79.1-21.2-21.2-49.2-32.8-79.1-32.8z"  ></path><path d="M924.8 626.1l-65.4-55.9c3.1-19 4.7-38.4 4.7-57.7s-1.6-38.8-4.7-57.7l65.4-55.9c10.1-8.6 13.8-22.6 9.3-35.2l-0.9-2.6c-18.1-50.4-44.8-96.8-79.6-137.7l-1.8-2.1c-8.6-10.1-22.5-13.9-35.1-9.5l-81.2 28.9c-30-24.6-63.4-44-99.6-57.5l-15.7-84.9c-2.4-13.1-12.7-23.3-25.8-25.7l-2.7-0.5c-52-9.4-106.8-9.4-158.8 0l-2.7 0.5c-13.1 2.4-23.4 12.6-25.8 25.7l-15.8 85.3c-35.9 13.6-69.1 32.9-98.9 57.3l-81.8-29.1c-12.5-4.4-26.5-0.7-35.1 9.5l-1.8 2.1c-34.8 41.1-61.5 87.4-79.6 137.7l-0.9 2.6c-4.5 12.5-0.8 26.5 9.3 35.2l66.2 56.5c-3.1 18.8-4.6 38-4.6 57 0 19.2 1.5 38.4 4.6 57l-66 56.5c-10.1 8.6-13.8 22.6-9.3 35.2l0.9 2.6c18.1 50.3 44.8 96.8 79.6 137.7l1.8 2.1c8.6 10.1 22.5 13.9 35.1 9.5l81.8-29.1c29.8 24.5 63 43.9 98.9 57.3l15.8 85.3c2.4 13.1 12.7 23.3 25.8 25.7l2.7 0.5c26.1 4.7 52.7 7.1 79.4 7.1 26.7 0 53.4-2.4 79.4-7.1l2.7-0.5c13.1-2.4 23.4-12.6 25.8-25.7l15.7-84.9c36.2-13.6 69.6-32.9 99.6-57.5l81.2 28.9c12.5 4.4 26.5 0.7 35.1-9.5l1.8-2.1c34.8-41.1 61.5-87.4 79.6-137.7l0.9-2.6c4.3-12.4 0.6-26.3-9.5-35z m-412.3 52.2c-97.1 0-175.8-78.7-175.8-175.8s78.7-175.8 175.8-175.8 175.8 78.7 175.8 175.8-78.7 175.8-175.8 175.8z"  ></path></symbol><symbol id="icon-a-userswitch-fill" viewBox="0 0 1024 1024"><path d="M512 565c133.7 0 242-108.3 242-242S645.7 81 512 81 270 189.3 270 323s108.3 242 242 242z m4.8 299.3a264.4 264.4 0 0 1 0-205.6c2.3-5.4 4.8-10.8 7.4-16a4 4 0 0 0-3.7-5.8H512a311.4 311.4 0 0 1-122.2-24.7 319.8 319.8 0 0 1-57.9-32 4 4 0 0 0-4.2-0.3C208.7 645.3 128 771.7 128 917v25a4 4 0 0 0 4 4h429.9a4 4 0 0 0 3-6.7 261.9 261.9 0 0 1-48.1-75zM760 568c-106 0-192 86-192 192s86 192 192 192 192-86 192-192-86-192-192-192z m-98.4 136a4 4 0 0 1 4-4h124v-33.4c0-16 20.8-22.1 29.4-8.7l36.9 57.5a16 16 0 0 1-13.5 24.6H665.6a4 4 0 0 1-4-4z m196.8 112a4 4 0 0 1-4 4h-124v33.4c0 16-20.8 22.1-29.4 8.7l-36.9-57.5a16 16 0 0 1 13.5-24.6h176.8a4 4 0 0 1 4 4z"  ></path></symbol><symbol id="icon-loading" viewBox="0 0 1024 1024"><path d="M563.2 819.2a102.4 102.4 0 1 1 0 204.8 102.4 102.4 0 0 1 0-204.8z m-320.4608-153.6a128 128 0 1 1 0 256 128 128 0 0 1 0-256z m592.7936 25.6a102.4 102.4 0 1 1 0 204.8 102.4 102.4 0 0 1 0-204.8zM947.2 477.1328a76.8 76.8 0 1 1 0 153.6 76.8 76.8 0 0 1 0-153.6zM128 307.2a128 128 0 1 1 0 256 128 128 0 0 1 0-256z m782.6432-40.6016a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM409.6 0a153.6 153.6 0 1 1 0 307.2 153.6 153.6 0 0 1 0-307.2z m384 153.6a25.6 25.6 0 1 1 0 51.2 25.6 25.6 0 0 1 0-51.2z"  ></path></symbol></svg>',function(i){var e=(e=document.getElementsByTagName("script"))[e.length-1],t=e.getAttribute("data-injectcss"),e=e.getAttribute("data-disable-injectsvg");if(!e){var s,l,m,w,T,k=function(v,h){h.parentNode.insertBefore(v,h)};if(t&&!i.__iconfont__svg__cssinject__){i.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(v){console&&console.log(v)}}s=function(){var v,h=document.createElement("div");h.innerHTML=i._iconfont_svg_string_3847283,(h=h.getElementsByTagName("svg")[0])&&(h.setAttribute("aria-hidden","true"),h.style.position="absolute",h.style.width=0,h.style.height=0,h.style.overflow="hidden",h=h,(v=document.body).firstChild?k(h,v.firstChild):v.appendChild(h))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(s,0):(l=function(){document.removeEventListener("DOMContentLoaded",l,!1),s()},document.addEventListener("DOMContentLoaded",l,!1)):document.attachEvent&&(m=s,w=i.document,T=!1,O(),w.onreadystatechange=function(){w.readyState=="complete"&&(w.onreadystatechange=null,I())})}function I(){T||(T=!0,m())}function O(){try{w.documentElement.doScroll("left")}catch(v){return void setTimeout(O,50)}I()}}(window);class o{constructor(t){n(this,"app");this.PIXI=t}mount(t,e,s){this.app||(this.app=new this.PIXI.Application({view:t,resolution:2,autoStart:!0,autoDensity:!0,backgroundAlpha:0,resizeTo:e})),s?(this.clearAppStage(),this.app.stage.addChild(s)):console.error("æŒ‚è½½æ¨¡åž‹å¤±è´¥")}unMount(){this.clearAppStage()}clearAppStage(){var e;(((e=this.app)==null?void 0:e.stage.children.length)||0)>0&&this.app.stage.removeChildren(0)}resize(){var t;(t=this.app)==null||t.resize()}}const a="https://lib.oml2d.com",E={mobileDisplay:!1,fixed:!0,primaryColor:"#38B0DE",sayHello:!0,transitionTime:1e3,parentElement:document.body,importType:"complete",libraryUrls:{complete:`${a}/complete.js`,cubism2:`${a}/live2d.min.js`,cubism5:`${a}/live2dcubismcore.min.js`},models:[],statusBar:{errorColor:"#F08080",style:{minWidth:"20px",minHeight:"40px",position:"fixed",transform:"translateX(-110%)",left:"0",bottom:"80px",padding:"7px 5px",zIndex:"9998",borderStyle:"solid",borderColor:"#fff",fontWeight:"bold",borderRadius:"0 5px 5px 0",borderWidth:"2px 2px 2px 0",boxShadow:"0 0 5px #999",color:"#fff",display:"flex",alignItems:"center",textAlign:"center",flexWrap:"wrap",fontSize:"14px",writingMode:"vertical-lr",cursor:"pointer"}},tips:{messageLine:3,mobileStyle:{},style:{position:"absolute",fontSize:"18px",borderRadius:"10px",filter:"drop-shadow(0 0 5px #999)",border:"2px solid #fff",color:"#fff",padding:"5px 5px",opacity:0,visibility:"hidden",transform:"translateX(-50%)",textAlign:"center",justifyContent:"center",animationDuration:"1000ms,1000ms",animationFillMode:"forwards, none",animationIterationCount:"1, infinite",width:"60%",left:"50%",top:0,display:"flex",alignItems:"center",minHeight:"100px"},idleTips:{wordTheDay:!1,message:[],duration:5e3,interval:1e4,priority:2},welcomeTips:{message:{daybreak:"æ—©ä¸Šå¥½ï¼ä¸€æ—¥ä¹‹è®¡åœ¨äºŽæ™¨ï¼Œç¾Žå¥½çš„ä¸€å¤©å°±è¦å¼€å§‹äº†ã€‚",morning:"ä¸Šåˆå¥½ï¼å·¥ä½œé¡ºåˆ©å˜›ï¼Œä¸è¦ä¹…åï¼Œå¤šèµ·æ¥èµ°åŠ¨èµ°åŠ¨å“¦ï¼",noon:"ä¸­åˆäº†ï¼Œå·¥ä½œäº†ä¸€ä¸ªä¸Šåˆï¼ŒçŽ°åœ¨æ˜¯åˆé¤æ—¶é—´ï¼",afternoon:"åˆåŽå¾ˆå®¹æ˜“çŠ¯å›°å‘¢ï¼Œæ¥æ¯å’–å•¡å§~",dusk:"å‚æ™šäº†ï¼å·¥ä½œä¸€å¤©å¹¸è‹¦å•¦~",night:"æ™šä¸Šå¥½ï¼Œä»Šå¤©è¿‡å¾—æ€Žä¹ˆæ ·å‘¢ï¼Ÿ",lateNight:"å·²ç»è¿™ä¹ˆæ™šäº†å‘€ï¼Œæ—©ç‚¹ä¼‘æ¯å§ï¼Œæ™šå®‰~",weeHours:"è¿™ä¹ˆæ™šè¿˜ä¸ç¡å—ï¼Ÿå½“å¿ƒç†¬å¤œç§ƒå¤´å“¦ï¼"},duration:6e3,priority:3},copyTips:{duration:3e3,priority:3,message:["ä½ å¤åˆ¶äº†ä»€ä¹ˆå†…å®¹å‘¢?è®°å¾—æ³¨æ˜Žå‡ºå¤„å“¦~"]}},menus:{style:{transition:"all 500ms",visibility:"hidden",opacity:0,position:"absolute",right:0,bottom:"10%",zIndex:"9999",fontSize:"26px"},itemStyle:{}}},u={globalStyle:"oml2d-global-style",stage:"oml2d-stage",canvas:"oml2d-canvas",statusBar:"oml2d-statusBar",tips:"oml2d-tips",menus:"oml2d-menus",iconSvg:"oml2d-icon-svg"},x=[{id:"Rest",name:"icon-bed",title:"ä¼‘æ¯"},{id:"SwitchModel",name:"icon-a-userswitch-fill",title:"åˆ‡æ¢æ¨¡åž‹"},{id:"About",name:"icon-info-circle-fill",title:"å…³äºŽ"}],y=i=>`
  @keyframes oml2d-shake-tips{
    0% {
      transform: translate(-50%, 5%) scale(0.99);
    }
    50% {
   
      transform: translate(-50%, 0%) scale(1);
    }
    100% {
      transform: translate(-50%, 5%) scale(0.99);
    }
  }
  
  @keyframes oml2d-stage-slide-in {
    from {
      transform: translateY(130%);
    }
    to {
      transform: translateY(0%);
    }
  }
  
  @keyframes oml2d-stage-slide-out {
    from {
      transform: translateY(0%);
    }
    to {
      transform: translateY(130%);
    }
  }
  
  @keyframes oml2d-display-tips {
    0% {
      opacity: 0;
      visibility: hidden;
    }
    100% {
      opacity: 1;
      visibility: visible;
    }
  }
  
  @keyframes oml2d-hidden-tips {
    0% {
      opacity: 1;
      visibility: visible;
    }
    100% {
      opacity: 0;
      visibility: hidden;
    }
  }

  @keyframes oml2d-loading-rotate {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  .oml2d-icon {
    width: 1em; 
    height: 1em;
    vertical-align: -0.15em;
    fill: currentColor;
    overflow: hidden;
  }
  
  .oml2d-loading{
    animation-name: oml2d-loading-rotate;
    animation-duration: 600ms;
    animation-iteration-count: infinite;
    animation-timing-function: linear;
  }

  .oml2d-menus-item {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    box-sizing: border-box;
    align-items: center;
    transition: all 300ms;
    color: ${i};
    cursor: pointer;
    background-color: #fff;
  }
  
  .oml2d-menus-item:hover {
    background-color: ${i};
    color: #fff;
    box-shadow: 0 0 5px #000;
  }
  
  #${u.menus} .oml2d-menus-item:not(:last-child) {
    margin-bottom: 10px;
  }
  
  
  
  @keyframes oml2d-status-bar-slide-out {
    0% {
      transform: translateX(0%);
    }
    100% {
      transform: translateX(-120%);
    }
  }
  
  
  @keyframes oml2d-status-bar-slide-in {
    0% {
      transform: translateX(-120%);
    }
    100% {
      transform: translateX(0%);
    }
  }
  `,S=i=>{const t=i.length;if(t===0)return;const e=Math.floor(Math.random()*t);return i[e]},D=(i,t)=>{let e;return{start:function(){return p(this,null,function*(){const s=()=>p(this,null,function*(){e&&(yield i(),clearTimeout(e),e=setTimeout(s,t))});e||(clearTimeout(e),e=setTimeout(s,t))})},stop:function(){clearTimeout(e),e=void 0}}},z=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),C=i=>typeof i=="number"||i instanceof Number,A=i=>typeof i=="function",c=(i,t)=>{const e=Object.assign({},i);return z(i)&&z(t)&&Object.keys(t).forEach(s=>{z(t[s])?s in i?e[s]=c(i[s],t[s]):Object.assign(e,{[s]:t[s]}):Object.assign(e,{[s]:t[s]})}),e};var d=(i=>(i.pc="PC",i.mobile="MOBILE",i))(d||{}),H=(i=>(i.ALL="ALL",i.IDLE="IDLE",i.NONE="NONE",i))(H||{});const $=function(i){const{message:t}=i;let e="";const s=new Date().getHours().toString(),l=/^[5-7]$/,m=/^(?:[8-9]|1[0-1])$/,w=/^(1[2-3])$/,T=/^1[4-7]$/,k=/^1[8-9]$/,I=/^2[0-1]$/,O=/^2[2-3]$/;return l.test(s)?e=t.daybreak:m.test(s)?e=t==null?void 0:t.morning:w.test(s)?e=t==null?void 0:t.noon:T.test(s)?e=t==null?void 0:t.afternoon:k.test(s)?e=t==null?void 0:t.dusk:I.test(s)?e=t==null?void 0:t.night:O.test(s)?e=t==null?void 0:t.lateNight:e=t==null?void 0:t.weeHours,e},j=()=>console.log(`
 %c ðŸŽ‰ðŸŽ‰ðŸŽ‰ %c %c âœ¨ oh-my-live2d v0.10.0 - https://oml2d.com Happy Hacking !! âœ¨ %c %c ðŸŽ‰ðŸŽ‰ðŸŽ‰ 
`,"background: #add7fb; padding:5px 0;","background: #58b0fc; padding:5px 0;","color: #fff; background: #030307; padding:5px 0;","background: #58b0fc; padding:5px 0;","background: #add7fb; padding:5px 0;"),f=i=>{const t=R({},i);return"width"in i&&C(i.width)&&(t.width=`${i.width}px`),"height"in i&&C(i.height)&&(t.height=`${i.height}px`),t},b=(i,t)=>{Object.assign(t.style,i)},F=i=>new Promise(t=>setTimeout(t,i)),g=i=>{const t=document.createElement(i.tagName);return t.id=i.id,i.className&&(t.className=i.className),i.dataName&&t.setAttribute("data-name",i.dataName),i.children&&i.children.forEach(e=>{t.appendChild(g(e))}),i.innerHtml&&(t.innerHTML=i.innerHtml),i.innerText&&(t.innerText=i.innerText),t},X=i=>(U(i==null?void 0:i.id),new Promise(t=>{const e=document.createElement("script");e.id=i==null?void 0:i.id,document.head.append(e),e.src=i==null?void 0:i.url,e.addEventListener("load",()=>{t()})})),W=()=>p(this,null,function*(){const i=yield fetch("https://unpkg.com/oh-my-live2d/package.json"),{version:t}=yield i.json();t!=="0.10.0"&&console.warn("[oml2d] æ£€æŸ¥åˆ° oh-my-live2d å­˜åœ¨æœ€æ–°ç‰ˆ:",`v${t}`,"è¯·å‰å¾€: https://oml2d.com ä»¥èŽ·å¾—æœ€æ–°ç‰ˆè¯¦ç»†ä¿¡æ¯, å¹¶åŠæ—¶æ›´æ–°.")}),B=i=>p(this,null,function*(){const e=yield(yield fetch("https://v1.hitokoto.cn/")).json();return i?i(e):`${e.hitokoto}    -- ${e.from}`}),Y=window.matchMedia("screen and (max-width: 768px)"),M=()=>Y.matches?d.mobile:d.pc,U=i=>{const t=document.getElementById(i);t==null||t.remove()},V=(i,t)=>{const{parentElement:e}=t,s=c(i,t);return s.parentElement=e||i.parentElement,s},G=(i,t)=>p(this,null,function*(){return yield X({url:t[i],id:`oml2d-${i}`}),window.PIXI.utils.skipHello(),{PIXI:window.PIXI,PixiLive2dDisplay:window.PIXI.live2d}});class K{constructor(t){n(this,"styleSheet");this.options=t}create(){this.styleSheet=g({tagName:"style",id:u.globalStyle,innerHtml:y(this.options.primaryColor)})}mount(){this.styleSheet&&document.head.append(this.styleSheet)}unMount(){var t;(t=this.styleSheet)==null||t.remove()}update(t){this.options=t,this.reloadStyleSheet()}initializeStyle(){this.reloadStyleSheet()}reloadStyleSheet(){this.styleSheet&&(this.styleSheet.innerHTML=y(this.options.primaryColor))}}class Q{constructor(t,e){n(this,"model");n(this,"currentModelIndex",0);n(this,"hitAreaFrames");this.options=t,this.PixiLive2dDisplay=e,this.hitAreaFrames=new e.HitAreaFrames}get modelIndex(){return this.currentModelIndex}set modelIndex(t){this.currentModelIndex=t}get currentModelOptions(){return this.options.models[this.modelIndex]}create(){return new Promise((t,e)=>{this.model=this.PixiLive2dDisplay.Live2DModel.fromSync(this.currentModelOptions.path,{motionPreload:this.currentModelOptions.motionPreloadStrategy||H.IDLE,onError:e}),this.model.once("load",t)})}settingModel(){switch(M()){case d.mobile:this.setPosition(...this.currentModelOptions.mobilePosition||[]),this.setScale(this.currentModelOptions.mobileScale);break;case d.pc:this.setPosition(...this.currentModelOptions.position||[]),this.setScale(this.currentModelOptions.scale);break}this.currentModelOptions.showHitAreaFrames&&this.addHitAreaFrames(),C(this.currentModelOptions.volume)&&(this.PixiLive2dDisplay.SoundManager.volume=this.currentModelOptions.volume)}addHitAreaFrames(){var t;(t=this.model)==null||t.addChild(this.hitAreaFrames)}removeHitAreaFrames(){var t;(t=this.model)==null||t.removeChildren(0)}get modelSize(){var t,e;return{width:((t=this.model)==null?void 0:t.width)||0,height:((e=this.model)==null?void 0:e.height)||0}}setScale(t=.1){var e;(e=this.model)==null||e.scale.set(t,t)}setPosition(t=0,e=0){this.model.x=t,this.model.y=e}onHit(t){var e;(e=this.model)==null||e.on("hit",s=>{t(s),this.playRandomMotion(s)})}playMotion(t,e){var s;(s=this.model)==null||s.motion(t,e)}playRandomMotion(t){var l;const e=Object.keys(((l=this.model)==null?void 0:l.internalModel.motionManager.motionGroups)||{});let s=e.find(m=>t[0].includes(m.toLowerCase())||m.toLowerCase().includes(t[0]));s||(s=S(e)),this.playMotion(s||"")}}class q{constructor(t){n(this,"element");n(this,"style",{});n(this,"itemStyle",{});n(this,"clickItem");n(this,"menuItemList",[]);this.options=t}createMenuItem(){var t;this.menuItemList=x.map(e=>{const s=g({id:e.id,tagName:"div",dataName:e.id,className:"oml2d-menus-item",innerHtml:`
      <svg class="oml2d-icon">
        <use xlink:href="#${e.name}"></use>
      </svg>
    `});return s.title=e.title,s}),(t=this.element)==null||t.addEventListener("click",e=>{var l;if(e.target===e.currentTarget)return;let s=e.target;for(;s.parentNode!==e.currentTarget;)s=s.parentNode;(l=this.clickItem)==null||l.call(this,s.getAttribute("data-name"))})}create(){this.element=g({id:u.menus,tagName:"div",className:u.menus}),this.createMenuItem()}mount(t){this.element&&(t.append(this.element),this.element.append(...this.menuItemList),t.addEventListener("mouseover",()=>this.setStyle({opacity:1,visibility:"visible"})),t.addEventListener("mouseout",()=>this.setStyle({opacity:0,visibility:"hidden"})))}reloadStyle(){switch(M()){case d.pc:this.setStyle(f(this.options.menus.style||{})),this.setItemStyle(f(this.options.menus.itemStyle||{}));break;case d.mobile:this.setStyle(f(this.options.menus.style||{})),this.setItemStyle(f(this.options.menus.itemStyle||{}));break}}initializeStyle(){this.reloadStyle()}update(t){this.options=t,this.reloadStyle()}onClickItem(t){this.clickItem=t}setStyle(t){this.element&&(this.style=c(this.style,t),b(this.style,this.element))}setItemStyle(t){this.itemStyle=c(this.itemStyle,t),this.menuItemList.forEach(e=>{b(this.itemStyle,e)})}}class J{constructor(t){n(this,"element");n(this,"canvasElement");n(this,"style",{});n(this,"canvasStyle",{});n(this,"slideChangeEnd");n(this,"currentModelIndex",0);this.options=t}create(){this.element=g({id:u.stage,tagName:"div"}),this.canvasElement=g({id:u.canvas,tagName:"canvas"})}set modelIndex(t){this.currentModelIndex=t}get modelIndex(){return this.currentModelIndex}mount(){this.element&&this.canvasElement&&(this.element.append(this.canvasElement),this.options.parentElement.append(this.element))}initializeStyle(){this.setStyle({width:"0px",height:"0px",position:"fixed",left:0,bottom:0,zIndex:"9997",transform:"translateY(130%)"}),this.reloadStyle()}reloadStyle(t={}){switch(M()){case d.mobile:t=c(t,this.options.models[this.modelIndex].mobileStageStyle||{}),this.setStyle(f(t));break;case d.pc:t=c(t,this.options.models[this.modelIndex].stageStyle||{}),this.setStyle(f(t));break}}unMount(){var t;(t=this.element)==null||t.remove()}reMount(){this.unMount(),this.mount()}setStyle(t,e){this.element&&(this.style=c(this.style,t),b(this.style,this.element),this.setCanvasStyle({width:"100%",height:"100%",zIndex:"9998",position:"relative"}),e==null||e())}setCanvasStyle(t){this.canvasElement&&(this.canvasStyle=c(this.canvasStyle,t),b(this.canvasStyle,this.canvasElement))}get transitionTime(){return this.options.transitionTime}slideIn(){return this.setStyle({animationName:"oml2d-stage-slide-in",animationDuration:`${this.transitionTime}ms`,animationFillMode:"forwards"}),new Promise(t=>{setTimeout(()=>{var e;(e=this.slideChangeEnd)==null||e.call(this,!0),t()},this.transitionTime)})}slideOut(){return this.setStyle({animationName:"oml2d-stage-slide-out",animationDuration:`${this.transitionTime}ms`,animationFillMode:"forwards"}),new Promise(t=>setTimeout(()=>{var e;(e=this.slideChangeEnd)==null||e.call(this,!1),t()},this.transitionTime))}onChangeSlideEnd(t){this.slideChangeEnd=t}}class Z{constructor(t){n(this,"element");n(this,"transitionTime",800);n(this,"status",0);n(this,"style",{});n(this,"timer",0);this.options=t}create(){this.element=g({id:u.statusBar,tagName:"div",innerText:"hello"})}mount(){this.element&&this.options.parentElement.append(this.element)}reloadStyle(){switch(M()){case d.pc:this.setStyle(f(this.options.statusBar.style||{}));break;case d.mobile:this.setStyle(f(this.options.statusBar.style||{}));break}}initializeStyle(){this.reloadStyle()}unMount(){var t;(t=this.element)==null||t.remove()}reMounte(){this.unMount(),this.mount()}setStyle(t){var e;this.element&&(this.style=c(this.style,t),(e=this.style).backgroundColor||(e.backgroundColor=this.stateColor.info),b(t,this.element))}slideIn(){return new Promise(t=>{this.status=1,this.setStyle({animationName:"oml2d-status-bar-slide-in",animationDuration:`${this.transitionTime}ms`,animationFillMode:"forwards"}),setTimeout(()=>{t(this.status)},this.transitionTime)})}slideOut(){return new Promise(t=>{this.status=0,this.setStyle({animationName:"oml2d-status-bar-slide-out",animationDuration:`${this.transitionTime}ms`,animationFillMode:"forwards"}),setTimeout(()=>{this.element&&(this.element.onclick=null,this.element.onmousemove=null,this.element.onmouseout=null),t(this.status)},this.transitionTime)})}showLoading(){this.popup(`
      <div style="margin-bottom:3px;">åŠ è½½ä¸­</div>
      <svg class="oml2d-icon oml2d-loading" aria-hidden="true">
        <use xlink:href="#icon-loading"></use>
      </svg>
    `,"info",!1)}hideLoading(){this.popup("åŠ è½½æˆåŠŸ")}setHoverAction(t,e){this.element&&(this.element.onmouseover=()=>{this.popup(t.content,t.state,!1)},this.element.onmouseout=()=>{this.popup(e.content,e.state,!1)})}clearHoverAction(){this.element&&(this.element.onmousemove=null,this.element.onmouseout=null)}loadingError(t){var s;this.popup("åŠ è½½å¤±è´¥","error",!1),this.setHoverAction({content:"é‡æ–°åŠ è½½",state:"info"},{content:"åŠ è½½å¤±è´¥",state:"error"});const e=()=>{var l;t(),this.clearHoverAction(),(l=this.element)==null||l.removeEventListener("click",e),this.showLoading()};(s=this.element)==null||s.addEventListener("click",e)}rest(t=!1,e){t?this.popup("çœ‹æ¿å¨˜ä¼‘æ¯ä¸­","info",!1,()=>{this.slideOut(),e==null||e()}):this.popup("çœ‹æ¿å¨˜ä¼‘æ¯ä¸­","info",8e3)}get stateColor(){return{info:this.options.primaryColor,error:this.options.statusBar.errorColor}}popup(t,e="info",s=1e3,l){clearTimeout(this.timer),this.setContent(t),this.setStyle({backgroundColor:this.stateColor[e]}),this.slideIn().then(()=>{s?this.timer=setTimeout(()=>{this.slideOut()},s):l&&this.element&&(this.element.onclick=l)})}setContent(t){this.element&&(this.element.innerHTML=t)}}class tt{constructor(t){n(this,"idlePlayer");n(this,"element");n(this,"contentElement");n(this,"closeTimer",0);n(this,"transitionTime",1e3);n(this,"style",{});n(this,"priority",0);n(this,"contentStyle",{});this.options=t,this.idlePlayer=this.createIdleMessagePlayer()}get tipsOptions(){return this.options.tips}create(){this.element=g({id:u.tips,tagName:"div"}),this.contentElement=g({id:"oml2d-tips-content",tagName:"div"})}mount(t){this.element&&this.contentElement&&(this.element.append(this.contentElement),t.append(this.element))}unMount(){var t;(t=this.element)==null||t.remove()}get primaryColor(){return this.options.primaryColor}reloadStyle(){switch(M()){case d.pc:this.setStyle(f(this.options.tips.style||{}));break;case d.mobile:this.setStyle(f(this.options.tips.mobileStyle||{}));break}}initializeStyle(){this.reloadStyle(),this.setContentStyle({wordBreak:"break-all",display:"-webkit-box",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:this.options.tips.messageLine,overflow:"hidden"})}setStyle(t={}){var e;this.element&&(this.style=c(this.style,t),(e=this.style).backgroundColor||(e.backgroundColor=this.options.primaryColor),b(this.style,this.element))}setContentStyle(t){this.contentElement&&(this.contentStyle=c(this.contentStyle,t),b(this.contentStyle,this.contentElement))}setContent(t){this.contentElement&&(this.contentElement.innerHTML=t)}showMessage(t,e=3e3,s=0){s<this.priority||(this.closeTimer&&clearTimeout(this.closeTimer),this.setContent(t),this.setStyle({animationName:"oml2d-display-tips,oml2d-shake-tips"}),this.closeTimer=setTimeout(()=>{this.setStyle({animationName:"oml2d-hidden-tips,oml2d-shake-tips"}),this.priority=0},e))}clear(){var t;this.setStyle({animationName:"oml2d-hidden-tips,oml2d-shake-tips"}),(t=this.idlePlayer)==null||t.stop(),clearTimeout(this.closeTimer),this.priority=0}notification(t,e=3e3,s=3){var l;(l=this.idlePlayer)==null||l.stop(),this.showMessage(t,e,s),setTimeout(()=>{var m;(m=this.idlePlayer)==null||m.start()},e+this.transitionTime)}welcome(){if(!this.options.tips)return;const t=$(this.tipsOptions.welcomeTips||{}),{duration:e,priority:s}=this.options.tips.welcomeTips;this.notification(t,e,s)}copy(){if(this.options.tips.copyTips.message.length){const t=S(this.options.tips.copyTips.message)||"";this.notification(t,this.options.tips.copyTips.duration,this.options.tips.copyTips.priority)}}createIdleMessagePlayer(){let t="";const e=D(()=>p(this,null,function*(){this.tipsOptions.idleTips.wordTheDay?A(this.tipsOptions.idleTips.wordTheDay)?t=yield B(this.tipsOptions.idleTips.wordTheDay):t=yield B():A(this.tipsOptions.idleTips.message)?t=yield this.tipsOptions.idleTips.message():t=S(this.tipsOptions.idleTips.message||[])||"",t?(this.showMessage(t,this.tipsOptions.idleTips.duration,this.tipsOptions.idleTips.priority),yield F(this.tipsOptions.idleTips.duration)):e.stop()}),this.options.tips.idleTips.interval);return e}}class et{constructor(t,e,s){n(this,"globalStyle");n(this,"stage");n(this,"statusBar");n(this,"tips");n(this,"menus");n(this,"models");n(this,"application");n(this,"currentModelIndex",0);this.options=t,this.PIXI=e,this.PixiLive2dDisplay=s,this.globalStyle=new K(t),this.stage=new J(t),this.statusBar=new Z(t),this.tips=new tt(t),this.menus=new q(t),this.models=new Q(t,s),this.application=new o(this.PIXI),this.modelIndex=0}set modelIndex(t){this.currentModelIndex=t,this.stage.modelIndex=t,this.models.modelIndex=t}get modelIndex(){return this.currentModelIndex}create(){this.globalStyle.create(),this.stage.create(),this.statusBar.create(),this.menus.create(),this.tips.create()}mount(){this.globalStyle.mount(),this.stage.mount(),this.statusBar.mount(),this.menus.mount(this.stage.element),this.tips.mount(this.stage.element)}unMount(){this.globalStyle.unMount(),this.stage.unMount(),this.statusBar.unMount(),this.tips.unMount()}loadModel(t=!0){return p(this,null,function*(){var e,s;t&&this.statusBar.showLoading(),yield this.models.create(),(e=this.application)==null||e.mount(this.stage.canvasElement,this.stage.element,this.models.model),this.models.settingModel(),this.stage.reloadStyle(this.models.modelSize),(s=this.application)==null||s.resize(),this.statusBar.hideLoading(),yield this.stage.slideIn()})}loadNextModel(){return p(this,null,function*(){var t;this.modelIndex++,this.modelIndex>this.options.models.length-1&&(this.modelIndex=0),this.statusBar.showLoading(),this.tips.clear(),yield this.stage.slideOut(),yield this.loadModel(!1),(t=this.tips.idlePlayer)==null||t.start()})}initializeStyle(){this.globalStyle.initializeStyle(),this.statusBar.initializeStyle(),this.tips.initializeStyle(),this.stage.initializeStyle(),this.menus.initializeStyle()}initialize(){return p(this,null,function*(){W(),this.options.sayHello&&j(),this.create(),this.initializeStyle(),this.mount(),this.registerEvent(),yield this.loadModel(),this.registerModelEvent()})}switchStatus(){this.stage.slideOut(),this.tips.clear(),this.statusBar.rest(!0,()=>{var t;this.stage.slideIn(),(t=this.tips.idlePlayer)==null||t.start()})}registerEvent(){this.stage.onChangeSlideEnd(t=>{t&&this.tips.welcome()}),window.document.oncopy=()=>{this.tips.copy()},this.menus.onClickItem(t=>{switch(t){case"Rest":this.switchStatus();return;case"SwitchModel":this.loadNextModel();return;case"About":window.open("https://oml2d.com");return}})}registerModelEvent(){this.models.onHit(()=>{})}}const it=(()=>{let i,t=E;return s=>p(this,null,function*(){t=V(E,s);const{PIXI:l,PixiLive2dDisplay:m}=yield G(t.importType,t.libraryUrls);return i==null||i.unMount(),i=new et(t,l,m),yield i.initialize(),i})})();r.loadOml2d=it,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
